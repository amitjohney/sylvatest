units:
  multus:
    enabled: true
  multus-ready:
    enabled: true
  kubevirt:
    enabled: true
  kubevirt-test-vms:
    enabled: true
  harbor:
    enabled: false
  harbor-init:
    enabled: false
  sriov-crd:
    enabled: true
  sriov:
    enabled: true
  sriov-resources:
    enabled: true
cluster:
  kubelet_extra_args:
    max-pods: "228"
    #node-labels: "feature.node.kubernetes.io/network-sriov.capable=true" ##should be set automatically by rancher-nfd
    feature-gates: "TopologyManager=true,CPUManager=true"
    topology-manager-policy: "best-effort"
    cpu-manager-policy: "static"
    system-reserved: "cpu=100m,memory=500Mi"
    kube-reserved: "cpu=100m,memory=500Mi"

  rke2:
    additionalUserData:
      config:
        #cloud-config
        # users:
        #   - name: node-admin
        #     groups: users
        #     sudo: ALL=(ALL) NOPASSWD:ALL
        #     shell: /bin/bash
        #     lock_passwd: false
        #     passwd: "$6$xdxPByGgJ8U$vXwpF2ToB0k.o/qgz7kfNyBFLUOr0AMkfk9Bx3o5DwZJlHAYutiRSeGdynWLFXCFb5KnvSBWuuemX7G6eeQyo."  # (copy pasted from /etc/shadow or created with "mkpasswd --method=SHA-512 --stdin")
        #     ssh_authorized_keys:
        #       - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDZ2hUiLBgImN1v66ZW1k3SjGKvLypBGCecONYQxZQlRn3T8mACLJNQtwrIQpf4nbzFgWnvq0oOZYw2hm+XCoQe8/T+t6dnmwVeKl3Gsm4N6szuEhpwzv7kV0WALe6tUM2JlFXu5tHX1HXKwH+dOHdzMJBDnwwOf1cUtGkmJEzx4ECgSqxOcc7bpJhdDZj3+dyg9UneLa/AitLStRQn4sklyrVzNsOIRhvWsaIn9/jEu2miO5ttrSp7NfgEUgitEiQZ9H37Z91++536Kmo4v7PnFWltNFI5BG8jLfcQzXMaq2gBoKXjiQh1TTT0aj+rTD//1DZAqhWxd5xIgMRewy9FaRYRt4dqKkvz1325gTr+wmJ2/uDP/wlcvi3pJq/Qq24Z4ZLl9sg7IRxJaiNvFxKL0kKFOCZRhxIST4LWLE/1A8Eb5hIpHzk7gWfN3IPi/9QfloCQ8ysLIe2Q3PkcsZhBENu3ug1EVzfEvdx40C9pZrF4/T7Bg1WOV6hPYfJnxg0= gitlab-runner@otccaasbm-runner


        bootcmd:
          - if [ ! -f "/var/lib/grub-init" ]; then
          - touch "/var/lib/grub-init"
          - current_grub=$(grep '^GRUB_CMDLINE_LINUX_DEFAULT=' /etc/default/grub | tail -1 | sed -e "s/^[^=]*=[\"']\\?//" -e "s/['\"]$//")
          - next_grub="$current_grub iommu=pt intel_iommu=on transparent_hugepage=never hugepagesz=2M hugepages=12000 hugepagesz=1G hugepages=16 default_hugepagesz=2M"
          # No need for a timeout. Nobody attends
          - sed -i -e '/GRUB_TIMEOUT=5/ d' /etc/default/grub
          # Delete the old command-line
          - sed -i -e '/^GRUB_CMDLINE_LINUX_DEFAULT=/ d' /etc/default/grub
          # No wait on reboot (first considered as failed)
          - echo "GRUB_RECORDFAIL_TIMEOUT=1" >> /etc/default/grub
          - echo "GRUB_CMDLINE_LINUX_DEFAULT=\"$next_grub\"" >> /etc/default/grub
          - update-grub
          - cloud-init clean --reboot
          - fi


sriov:
  node_policies:
    dl360-sriov:
      resourceName: sriov
      numVfs: 16
      deviceType: "vfio-pci"
      nicSelector:
        pfNames:
          - ens2f0

