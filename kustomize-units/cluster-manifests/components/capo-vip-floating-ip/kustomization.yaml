apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

patches:
- target:
    kind: HeatStack
  patch: |
    - op: add
      path: /spec/template/resources/floating-ip
      value:
        type: OS::Neutron::FloatingIP
        properties:
          floating_network: ${CAPO_EXTERNAL_NETWORK_ID}
          port_id: { get_resource: port }
- target:
    kind: HeatStack
  patch: |
    - op: add
      path: /spec/template/outputs/allocated_fip
      value:
        value: { get_attr: [floating-ip, floating_ip_address] }
        description: Floating IP associated to the port
