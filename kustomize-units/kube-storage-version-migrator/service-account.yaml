apiVersion: v1
kind: ServiceAccount
metadata:
  name: kube-storage-version-migrator
  namespace: kube-storage-version-migrator
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kube-storage-version-migrator
rules:
# rules to manipulate the custom resource
- apiGroups:
  - migration.k8s.io
  resources:
  - "*"
  verbs:
  - get
  - list
  - patch
  - update
  - watch
# rules to let the tool manipulate the CRDs we need
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - openstackclusters.infrastructure.cluster.x-k8s.io
  - openstackclustertemplates.infrastructure.cluster.x-k8s.io
  - openstackmachines.infrastructure.cluster.x-k8s.io
  - openstackmachinetemplates.infrastructure.cluster.x-k8s.io
  verbs:
  - get
  - list
# resources that we want to let the tool migrate
- apiGroups:
  - infrastructure.cluster.x-k8s.io
  resources:
  - openstackclusters
  - openstackclustertemplates
  - openstackmachines
  - openstackmachinetemplates
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kube-storage-version-migrator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kube-storage-version-migrator
subjects:
- kind: ServiceAccount
  name: kube-storage-version-migrator
  namespace: kube-storage-version-migrator
