{{- $envAll := set . "Values" (include "interpret-values-gotpl" . | fromJson) -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-vars
  labels:
{{ include "sylva-units.labels" $envAll | indent 4 }}
data:
  CLUSTER_NAME: {{ .Values.cluster.name }}
  MACHINE_IMAGE: {{ .Values.cluster.image }}
{{ if eq .Values.cluster.capi_providers.infra_provider "capo" }}
  FLAVOR_NAME: {{ .Values.cluster.capo.flavor_name }}
  SSH_KEY_NAME: {{ .Values.cluster.capo.ssh_key_name }}
  CAPO_NETWORK_ID: {{ .Values.cluster.capo.network_id }}
{{ end }}
{{ if eq .Values.cluster.capi_providers.infra_provider "capv" }}
  VS_DC_NAME: {{ .Values.cluster.capv.dataCenter }}
  VS_NETWORK: {{ .Values.cluster.capv.network }}
  VS_SERVER: {{ .Values.cluster.capv.server }}
  VS_TLS_THUMBPRINT: {{ .Values.cluster.capv.tlsThumbprint }}
{{ end }}
{{ if eq .Values.cluster.capi_providers.infra_provider "capm3" }}
  IMAGE_URL: {{ .Values.cluster.capm3.imageUrl }}
  IMAGE_FORMAT: {{ .Values.cluster.capm3.imageFormat }}
  IMAGE_CHECKSUM_TYPE: {{ .Values.cluster.capm3.imageChecksumType }}
  IMAGE_CHECKSUM: {{ .Values.cluster.capm3.imageChecksum }}
  NODE_DRAIN_TIMEOUT: {{ .Values.cluster.capm3.nodeDrainTimeOut }}
  CTLPLANE_KUBEADM_EXTRA_CONFIG: {{ .Values.cluster.capm3.controlPlaneKubeadmExtraConfig }}
  WORKERS_KUBEADM_EXTRA_CONFIG: {{ .Values.cluster.capm3.workersKubeadmExtraConfig }}
{{ end }}
  CLUSTER_EXTERNAL_IP: {{ .Values.cluster.cluster_external_ip }}
