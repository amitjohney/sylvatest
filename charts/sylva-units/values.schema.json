{
  "$schema": "https://json-schema.org/draft/2020-12/schema#",
  "title": "Schema for sylva-units chart values",
  "description": "---------------------------------------------------------------------- DO NOT EDIT THIS FILE AS JSON, THE YAML VERSION IS THE SOURCE OF TRUTH ----------------------------------------------------------------------",
  "$defs": {
    "gotpl": {
      "type": "string",
      "pattern": "^{{ .* }}$"
    },
    "username-password": {
      "anyOf": [
        {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            "^(username|password)$": {
              "type": "string"
            }
          }
        },
        {
          "$ref": "#/$defs/gotpl"
        }
      ]
    },
    "boolean-string": {
      "type": "string",
      "enum": [
        "true",
        "false",
        ""
      ]
    },
    "enabled": {
      "anyOf": [
        {
          "type": "boolean"
        },
        {
          "$ref": "#/$defs/gotpl"
        },
        {
          "$ref": "#/$defs/boolean-string"
        }
      ]
    },
    "string-with-gotpl": {
      "type": "string",
      "pattern": ".*{{ .* }}.*"
    }
  },
  "additionalProperties": false,
  "required": [
    "registry_secret",
    "git_repo_spec_default",
    "source_templates",
    "helm_repo_spec_default",
    "unit_kustomization_spec_default",
    "unit_helmrelease_spec_default",
    "unit_helmrelease_kustomization_spec_default",
    "units",
    "cluster",
    "proxies",
    "env_type_ci",
    "registry_mirrors"
  ],
  "properties": {
    "fullnameOverride": {
      "type": "string"
    },
    "nameOverride": {
      "type": "string"
    },
    "registry_secret": {
      "type": "object",
      "patternProperties": {
        "^[a-z0-9][a-z0-9.-]*[a-z0-9]$": {
          "anyOf": [
            {
              "type": "string",
              "pattern": "{{ .* }}"
            },
            {
              "$ref": "#/$defs/username-password"
            }
          ]
        }
      }
    },
    "git_repo_spec_default": {
      "type": "object"
    },
    "oci_repo_spec_default": {
      "type": "object"
    },
    "source_templates": {
      "type": "object",
      "additionalProperties": false,
      "patternProperties": {
        "^[a-z0-9][a-z0-9.-]*[a-z0-9]$": {
          "type": "object",
          "additionalProperties": false,
          "anyOf": [
            {
              "required": [
                "spec",
                "kind"
              ]
            },
            {
              "required": [
                "existing_source"
              ]
            }
          ],
          "properties": {
            "existing_source": {
              "anyOf": [
                {
                  "type": "null"
                },
                {
                  "type": "object",
                  "required": [
                    "name",
                    "kind"
                  ],
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "kind": {
                      "type": "string",
                      "enum": [
                        "GitRepository",
                        "OCIRepository"
                      ]
                    }
                  }
                }
              ]
            },
            "auth": {
              "$ref": "#/$defs/username-password"
            },
            "kind": {
              "type": "string",
              "enum": [
                "GitRepository",
                "OCIRepository"
              ]
            },
            "spec": {
              "type": "object",
              "required": [
                "url",
                "ref"
              ],
              "properties": {
                "url": {
                  "anyOf": [
                    {
                      "type": "string",
                      "format": "uri"
                    },
                    {
                      "$ref": "#/$defs/string-with-gotpl"
                    }
                  ]
                }
              },
              "not": {
                "required": [
                  "secretRef"
                ]
              }
            }
          },
          "allOf": [
            {
              "if": {
                "properties": {
                  "kind": {
                    "const": "GitRepository"
                  }
                }
              },
              "then": {
                "properties": {
                  "spec": {
                    "type": "object",
                    "properties": {
                      "ref": {
                        "type": "object",
                        "additionalProperties": false,
                        "anyOf": [
                          {
                            "required": [
                              "branch"
                            ]
                          },
                          {
                            "required": [
                              "tag"
                            ]
                          },
                          {
                            "required": [
                              "commit"
                            ]
                          }
                        ],
                        "patternProperties": {
                          "(branch|tag|commit)": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            {
              "if": {
                "properties": {
                  "kind": {
                    "const": "OCIRepository"
                  }
                }
              },
              "then": {
                "properties": {
                  "spec": {
                    "type": "object",
                    "properties": {
                      "ref": {
                        "type": "object",
                        "additionalProperties": false,
                        "anyOf": [
                          {
                            "required": [
                              "digest"
                            ]
                          },
                          {
                            "required": [
                              "semver"
                            ]
                          },
                          {
                            "required": [
                              "tag"
                            ]
                          }
                        ],
                        "patternProperties": {
                          "(digest|semver|tag)": {
                            "type": "string"
                          },
                          "branch": {
                            "type": "null"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          ]
        }
      }
    },
    "helm_repo_spec_default": {
      "type": "object"
    },
    "unit_kustomization_spec_default": {
      "type": "object"
    },
    "unit_helmrelease_spec_default": {
      "type": "object"
    },
    "unit_helmrelease_kustomization_spec_default": {
      "type": "object"
    },
    "units": {
      "type": "object",
      "patternProperties": {
        "^[a-z0-9][a-z0-9-]*[a-z0-9]$": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "$ref": "#/$defs/enabled"
            },
            "repo": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ]
            },
            "labels": {
              "type": "object",
              "patternProperties": {
                ".*": {
                  "type": "string"
                }
              }
            },
            "annotations": {
              "type": "object",
              "patternProperties": {
                ".*": {
                  "type": "string"
                }
              }
            },
            "depends_on": {
              "type": "object",
              "patternProperties": {
                "^([a-z0-9][a-z0-9-]*[a-z0-9]|{{ .* }})$": {
                  "anyOf": [
                    {
                      "type": "boolean"
                    },
                    {
                      "$ref": "#/$defs/gotpl"
                    }
                  ]
                }
              }
            },
            "ref_override": {
              "type": "string"
            },
            "kustomization_spec": {
              "type": "object",
              "properties": {
                "path": {
                  "type": "string"
                },
                "_patches": {
                  "type": "array",
                  "items": {
                    "anyOf": [
                      {
                        "type": "object"
                      },
                      {
                        "$ref": "#/$defs/gotpl"
                      }
                    ]
                  }
                },
                "_components": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              },
              "allOf": [
                {
                  "not": {
                    "required": [
                      "dependsOn"
                    ]
                  }
                },
                {
                  "not": {
                    "required": [
                      "wait",
                      "healthChecks"
                    ],
                    "properties": {
                      "wait": {
                        "const": true
                      }
                    }
                  }
                },
                {
                  "not": {
                    "required": [
                      "sourceRef"
                    ]
                  }
                }
              ]
            },
            "helmrelease_spec": {
              "type": "object",
              "required": [
                "chart"
              ],
              "properties": {
                "chart": {
                  "type": "object",
                  "required": [
                    "spec"
                  ],
                  "properties": {
                    "spec": {
                      "type": "object",
                      "required": [
                        "chart"
                      ],
                      "properties": {
                        "chart": {
                          "type": "string"
                        }
                      }
                    }
                  }
                },
                "_postRenderers": {
                  "type": "array",
                  "items": {
                    "anyOf": [
                      {
                        "type": "object"
                      },
                      {
                        "$ref": "#/$defs/gotpl"
                      }
                    ]
                  }
                }
              },
              "not": {
                "required": [
                  "dependsOn"
                ]
              }
            },
            "helm_repo_url": {
              "anyOf": [
                {
                  "type": "string",
                  "pattern": "(https?|oci)://.*"
                },
                {
                  "$ref": "#/$defs/gotpl"
                }
              ]
            },
            "helm_secret_values": {
              "type": "object"
            },
            "kustomization_substitute_secrets": {
              "type": "object",
              "additionalProperties": false,
              "patternProperties": {
                "^.*$": {
                  "type": "string"
                }
              }
            }
          },
          "required": [
            "enabled"
          ],
          "dependentRequired": {
            "kustomization_substitute_secrets": [
              "kustomization_spec"
            ],
            "helm_secret_values": [
              "helmrelease_spec"
            ],
            "helm_repo_url": [
              "helmrelease_spec"
            ]
          },
          "allOf": [
            {
              "anyOf": [
                {
                  "required": [
                    "helmrelease_spec"
                  ]
                },
                {
                  "required": [
                    "kustomization_spec"
                  ]
                }
              ]
            },
            {
              "anyOf": [
                {
                  "properties": {
                    "enabled": {
                      "const": false
                    }
                  }
                },
                {
                  "allOf": [
                    {
                      "not": {
                        "required": [
                          "repo",
                          "helm_repo_url"
                        ],
                        "properties": {
                          "repo": {
                            "type": "string"
                          }
                        }
                      }
                    },
                    {
                      "if": {
                        "not": {
                          "required": [
                            "helmrelease_spec"
                          ]
                        }
                      },
                      "then": {
                        "properties": {
                          "kustomization_spec": {
                            "allOf": [
                              {
                                "required": [
                                  "path"
                                ]
                              },
                              {
                                "anyOf": [
                                  {
                                    "required": [
                                      "wait"
                                    ]
                                  },
                                  {
                                    "required": [
                                      "healthChecks"
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      }
                    },
                    {
                      "if": {
                        "required": [
                          "helmrelease_spec"
                        ]
                      },
                      "then": {
                        "properties": {
                          "kustomization_spec": {
                            "not": {
                              "required": [
                                "path"
                              ]
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    },
    "cluster": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "capi_providers",
        "image"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "admin_password": {
          "type": "string"
        },
        "image": {
          "type": "string"
        },
        "worker_machine_image": {
          "type": "string"
        },
        "cis_profile": {
          "type": "string",
          "pattern": "cis-1.6|cis-1.23"
        },
        "capi_providers": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "infra_provider": {
              "enum": [
                "capd",
                "capo",
                "capv",
                "capm3"
              ]
            },
            "bootstrap_provider": {
              "enum": [
                "cabpk",
                "cabpr"
              ]
            }
          }
        },
        "cluster_external_ip": {
          "type": "string",
          "format": "ipv4"
        },
        "display_external_ip": {
          "type": "string"
        },
        "cluster_external_domain": {
          "type": "string",
          "format": "hostname"
        },
        "control_plane_replicas": {
          "type": "integer"
        },
        "worker_replicas": {
          "type": "integer"
        },
        "k8s_version": {
          "type": "string"
        },
        "cis_benchmark_scan_profile": {
          "type": "string"
        },
        "flux_webui": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "admin_user": {
              "type": "string"
            },
            "admin_password": {
              "type": "string"
            }
          }
        },
        "rancher": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "external_hostname": {
              "anyOf": [
                {
                  "type": "string",
                  "format": "hostname"
                },
                {
                  "$ref": "#/$defs/string-with-gotpl"
                }
              ]
            }
          }
        },
        "vault": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "external_hostname": {
              "anyOf": [
                {
                  "type": "string",
                  "format": "hostname"
                },
                {
                  "$ref": "#/$defs/string-with-gotpl"
                }
              ]
            }
          }
        },
        "keycloak": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "external_hostname": {
              "anyOf": [
                {
                  "type": "string",
                  "format": "hostname"
                },
                {
                  "$ref": "#/$defs/string-with-gotpl"
                }
              ]
            }
          }
        },
        "flux": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "external_hostname": {
              "anyOf": [
                {
                  "type": "string",
                  "format": "hostname"
                },
                {
                  "$ref": "#/$defs/string-with-gotpl"
                }
              ]
            }
          }
        },
        "capd": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "docker_host": {
              "type": "string",
              "format": "uri",
              "pattern": "^(unix|tcp)://.*"
            }
          }
        },
        "capo": {
          "type": "object"
        },
        "capv": {
          "type": "object"
        },
        "test_workload_cluster_name": {
          "type": "string",
          "pattern": "^[a-z0-9][a-z0-9-]*[a-z0-9]$"
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "capi_providers": {
                "properties": {
                  "infra_provider": {
                    "const": "capo"
                  }
                }
              },
              "worker_replicas": {
                "type": "integer",
                "minimum": 1
              }
            }
          },
          "then": {
            "properties": {
              "capo": {
                "type": "object",
                "properties": {
                  "worker_az": {
                    "type": "string"
                  }
                },
                "required": [
                  "worker_az"
                ]
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "capi_providers": {
                "properties": {
                  "infra_provider": {
                    "const": "capo"
                  }
                }
              }
            }
          },
          "then": {
            "properties": {
              "capo": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "flavor_name": {
                    "type": "string"
                  },
                  "worker_flavor_name": {
                    "type": "string"
                  },
                  "control_plane_az": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "worker_az": {
                    "type": "string"
                  },
                  "ssh_key_name": {
                    "type": "string"
                  },
                  "floating_ip": {
                    "anyOf": [
                      {
                        "type": "string",
                        "format": "ipv4"
                      },
                      {
                        "type": "string",
                        "maxLength": 0
                      }
                    ]
                  },
                  "network_id": {
                    "type": "string"
                  },
                  "external_network_id": {
                    "type": "string"
                  },
                  "control_plane_servergroup_id": {
                    "type": "string"
                  },
                  "control_plane_affinity_policy": {
                    "type": "string",
                    "enum": [
                      "anti-affinity",
                      "soft-anti-affinity"
                    ]
                  },
                  "worker_servergroup_id": {
                    "type": "string"
                  },
                  "worker_affinity_policy": {
                    "type": "string",
                    "enum": [
                      "anti-affinity",
                      "soft-anti-affinity"
                    ]
                  },
                  "additional_networks": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "virtio_network_id": {
                        "type": "string"
                      },
                      "direct_network_id": {
                        "type": "string"
                      }
                    }
                  },
                  "rootVolume": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "diskSize": {
                        "type": "integer"
                      },
                      "volumeType": {
                        "type": "string"
                      }
                    }
                  },
                  "clouds_yaml": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "clouds": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": [
                          "capo_cloud"
                        ],
                        "patternProperties": {
                          "(capo_cloud|.*)": {
                            "type": "object",
                            "additionalProperties": true,
                            "required": [
                              "auth"
                            ],
                            "properties": {
                              "auth": {
                                "type": "object",
                                "additionalProperties": true,
                                "required": [
                                  "auth_url",
                                  "username",
                                  "password",
                                  "project_name",
                                  "project_domain_name",
                                  "user_domain_name"
                                ],
                                "properties": {
                                  "auth_url": {
                                    "type": "string",
                                    "format": "uri"
                                  },
                                  "user_domain_name": {
                                    "type": "string"
                                  },
                                  "project_domain_name": {
                                    "type": "string"
                                  },
                                  "project_name": {
                                    "type": "string"
                                  },
                                  "username": {
                                    "type": "string"
                                  },
                                  "password": {
                                    "type": "string"
                                  }
                                }
                              },
                              "region_name": {
                                "anyOf": [
                                  {
                                    "type": "string"
                                  },
                                  {
                                    "type": "null"
                                  }
                                ]
                              },
                              "verify": {
                                "type": "boolean"
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "cacert": {
                    "type": "string"
                  },
                  "storageClass": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "type": {
                        "type": "string"
                      }
                    },
                    "required": [
                      "type"
                    ]
                  },
                  "resources_tag": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "capi_providers": {
                "properties": {
                  "infra_provider": {
                    "const": "capv"
                  }
                }
              }
            }
          },
          "then": {
            "properties": {
              "capv": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "dataCenter": {
                    "type": "string"
                  },
                  "network": {
                    "type": "string"
                  },
                  "server": {
                    "type": "string"
                  },
                  "dataStore": {
                    "type": "string"
                  },
                  "tlsThumbprint": {
                    "type": "string"
                  },
                  "username": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  },
                  "ssh_key": {
                    "type": "string"
                  },
                  "folder": {
                    "type": "string"
                  },
                  "resourcePool": {
                    "type": "string"
                  },
                  "storagePolicyName": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      ]
    },
    "proxies": {
      "type": "object",
      "additionalProperties": false,
      "patternProperties": {
        "https?_proxy": {
          "type": "string",
          "pattern": "^(https?://.*|)$"
        },
        "no_proxy": {
          "type": "string"
        }
      },
      "required": [
        "http_proxy",
        "https_proxy",
        "no_proxy"
      ]
    },
    "no_proxy_additional": {
      "type": "object",
      "additionalProperties": false,
      "patternProperties": {
        ".*": {
          "type": "boolean"
        }
      }
    },
    "sylva_base_oci_registry": {
      "anyOf": [
        {
          "type": "string",
          "format": "uri",
          "pattern": "^oci://.*$"
        },
        {
          "$ref": "#/$defs/string-with-gotpl"
        }
      ]
    },
    "sylva_core_oci_registry": {
      "anyOf": [
        {
          "type": "string",
          "format": "uri",
          "pattern": "^oci://.*$"
        },
        {
          "$ref": "#/$defs/string-with-gotpl"
        }
      ]
    },
    "metallb_helm_oci_url": {
      "anyOf": [
        {
          "type": "string",
          "pattern": "^oci://.*"
        },
        {
          "$ref": "#/$defs/string-with-gotpl"
        }
      ]
    },
    "registry_mirrors": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "default_settings": {
          "type": "object"
        },
        "hosts_config": {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            "^[a-z0-9][a-z0-9.-]*[a-z0-9]$": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "registry_settings": {
                    "type": "object"
                  },
                  "mirror_url": {
                    "type": "string",
                    "format": "uri",
                    "pattern": "^(https?://.*|)$"
                  }
                }
              }
            }
          }
        }
      }
    },
    "units_override_enabled": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "env_type_ci": {
      "type": "boolean"
    },
    "ntp": {
      "type": "object",
      "additionalProperties": false,
      "patternProperties": {
        "enabled": {
          "type": "boolean"
        },
        "servers": {
          "type": "array",
          "items": {
            "anyOf": [
              {
                "type": "string",
                "format": "ipv4"
              },
              {
                "type": "string",
                "format": "hostname"
              }
            ]
          }
        }
      }
    },
    "_internal": {
      "type": "object"
    }
  }
}