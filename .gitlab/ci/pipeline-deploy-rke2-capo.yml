---
include:
  - local: .gitlab/ci/child-pipeline-default.yml
  - local: .gitlab/ci/templates-deployments.yml

#----------------------------------------------------------

.deploy-rke2-capo:
  extends: .deploy-capo

deploy-rke2-capo:
  extends: [.deploy-rke2-capo]
  rules:
    - if: $OCI_TAG == null
  artifacts:
    expose_as: deploy-rke-capo

deploy-rke2-capo-oci:
  extends: [.deploy-rke2-capo]
  rules:
    - if: $OCI_TAG
  artifacts:
    expose_as: deploy-rke-capo-oci

#----------------------------------------------------------

.apply-rke2-capo:
  extends: .apply-capo

update-rke2-capo:
  extends: [.apply-rke2-capo]
  rules:
    - if: $OCI_TAG == null
  artifacts:
    expose_as: apply-rke2-capo

update-rke2-capo-oci:
  extends: [.apply-rke2-capo]
  rules:
    - if: $OCI_TAG
  artifacts:
    expose_as: apply-rke2-capo-oci

#----------------------------------------------------------

.deploy-wc-rke2-capo:
  extends: .deploy-wc-capo

deploy-wc-rke2-capo:
  extends: [.deploy-wc-rke2-capo]
  rules:
    - if: $OCI_TAG == null
  artifacts:
    expose_as: deploy-wc-rke2-capo

deploy-wc-rke2-capo-oci:
  extends: [.deploy-wc-rke2-capo]
  rules:
    - if: $OCI_TAG
  artifacts:
    expose_as: deploy-wc-rke2-capo-oci

#----------------------------------------------------------

update-wc-rke2-capo:
  extends: [.apply-wc-capo]
  rules:
    - if: $OCI_TAG == null
  artifacts:
    expose_as: update-wc-rke2-capo

update-wc-rke2-capo-oci:
  extends: [.apply-wc-capo]
  rules:
    - if: $OCI_TAG
  artifacts:
    expose_as: update-wc-rke2-capo-oci

#----------------------------------------------------------

test-workload-cluster-rke2-capo:
  extends: [.test-workload-cluster]
  rules:
    - if: $OCI_TAG == null

test-workload-cluster-rke2-capo-oci:
  extends: [.test-workload-cluster]
  rules:
    - if: $OCI_TAG

test-workload-cluster-no-sso-rke2-capo:
  extends: [.test-workload-cluster-no-sso]
  rules:
    - if: $OCI_TAG == null

test-workload-cluster-no-sso-rke2-capo-oci:
  extends: [.test-workload-cluster-no-sso]
  rules:
    - if: $OCI_TAG

#----------------------------------------------------------

.test-login-rke2-capo:
  extends: .test-login

test-login-rke2-capo:
  extends: [.test-login-rke2-capo]
  rules:
    - if: $OCI_TAG == null
  artifacts:
    expose_as: test-login-rke2-capo

test-login-rke2-capo-oci:
  extends: [.test-login-rke2-capo]
  rules:
    - if: $OCI_TAG
  artifacts:
    expose_as: test-login-rke2-capo-oci

#----------------------------------------------------------

cleanup-rke2-capo:
  extends: .cleanup-capo
  when: always
