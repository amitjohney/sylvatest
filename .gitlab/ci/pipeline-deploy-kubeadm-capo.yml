---
include:
  - local: .gitlab/ci/child-pipeline-default.yml
  - local: .gitlab/ci/templates-deployments.yml

#----------------------------------------------------------

.deploy-kubeadm-capo:
  extends: .deploy-capo

deploy-kubeadm-capo:
  extends: [.deploy-kubeadm-capo]
  rules:
    - if: $OCI_TAG == null
  artifacts:
    expose_as: deploy-kubeadm-capo

deploy-kubeadm-capo-oci:
  extends: [.deploy-kubeadm-capo]
  rules:
    - if: $OCI_TAG
  artifacts:
    expose_as: deploy-kubeadm-capo-oci

#----------------------------------------------------------

.apply-kubeadm-capo:
  extends: .apply-capo

update-kubeadm-capo:
  extends: [.apply-kubeadm-capo]
  rules:
    - if: $OCI_TAG == null && $CI_MERGE_REQUEST_LABELS =~ /run-e2e-tests/
  artifacts:
    expose_as: apply-kubeadm-capo

update-kubeadm-capo-oci:
  extends: [.apply-kubeadm-capo]
  rules:
    - if: $OCI_TAG && $CI_MERGE_REQUEST_LABELS =~ /run-e2e-tests/
  artifacts:
    expose_as: apply-kubeadm-capo-oci

#----------------------------------------------------------

.deploy-wc-kubeadm-capo:
  extends: .deploy-wc-capo

deploy-wc-kubeadm-capo:
  extends: [.deploy-wc-kubeadm-capo]
  rules:
    - if: $OCI_TAG == null && $CI_MERGE_REQUEST_LABELS =~ /run-e2e-tests/
  artifacts:
    expose_as: deploy-wc-kubeadm-capo

deploy-wc-kubeadm-capo-oci:
  extends: [.deploy-wc-kubeadm-capo]
  rules:
    - if: $OCI_TAG && $CI_MERGE_REQUEST_LABELS =~ /run-e2e-tests/
  artifacts:
    expose_as: deploy-wc-kubeadm-capo-oci

#----------------------------------------------------------


test-workload-cluster-kubeadm-capo:
  extends: [.test-workload-cluster]
  rules:
    - if: $OCI_TAG == null && $CI_MERGE_REQUEST_LABELS =~ /run-e2e-tests/

test-workload-cluster-kubeadm-capo-oci:
  extends: [.test-workload-cluster]
  rules:
    - if: $OCI_TAG && $CI_MERGE_REQUEST_LABELS =~ /run-e2e-tests/

#----------------------------------------------------------

.test-login-kubeadm-capo:
  extends: .test-login

test-login-kubeadm-capo:
  extends: [.test-login-kubeadm-capo]
  rules:
    - if: $OCI_TAG == null
  artifacts:
    expose_as: login-kubeadm-capo

test-login-kubeadm-capo-oci:
  extends: [.test-login-kubeadm-capo]
  rules:
    - if: $OCI_TAG
  artifacts:
    expose_as: login-kubeadm-capo-oci

#----------------------------------------------------------

cleanup-kubeadm-capo:
  extends: .cleanup-capo
  when: always
