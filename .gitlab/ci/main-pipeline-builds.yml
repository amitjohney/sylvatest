# ==========================================
# Build stage
# ==========================================


.build-base:
  stage: build
  dependencies: []
  variables:
    OCI_REGISTRY: oci://${CI_REGISTRY_IMAGE}
    OCI_TAG: $OCI_TAG_FORMAT
  rules:
    - when: on_success

publish-kustomize-units-artifact:
  extends: .build-base
  script:
    - tools/oci/build-kustomize-units-artifact.sh ${OCI_TAG}

push-helm-artifacts:
  extends: .build-base
  script:
    - tools/oci/push-helm-charts-artifacts.sh "oci://${CI_REGISTRY_IMAGE}"

publish-sylva-units-artifact:
  extends: .build-base
  script:
    - tools/oci/build-sylva-units-artifact.sh ${OCI_TAG}
