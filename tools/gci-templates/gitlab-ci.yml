---
image: registry.gitlab.com/sylva-projects/sylva-elements/container-images/ci-image:v1-0-4

default:
  before_script:
    - chart_dir=charts/${HELM_NAME}
    # we replace 'helm' by a wrapper ignoring the warnings about symlinks
    - |
      function helm() { $(which helm) $@ 2> >(grep -v 'found symbolic link' >&2); }

.helm-lint:
  script:
    - helm lint $chart_dir

.helm-yamllint:
  script:
    - yamllint $chart_dir -d "$(cat < tools/gci-templates/yamllint.yaml) $(cat < tools/gci-templates/yamllint-helm-exclude-chart-templates.yaml)"

.helm-template-yamllint:
  script:
    - tools/gci-templates/scripts/helm-template-yamllint.sh

.helm-schema-validation:
  script:
    - tools/gci-templates/scripts/helm-schema-validation.sh

.kustomize-build:
  script:
    - kubectl kustomize ${KUSTOMIZATION_PATH}
