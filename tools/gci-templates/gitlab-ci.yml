---
image: docker:latest

default:
  before_script:
    - apk add --no-cache curl bash git yamllint
    - curl -L https://get.helm.sh/helm-v3.10.1-linux-amd64.tar.gz | tar xz
    - mv linux-amd64/helm /usr/local/bin/

.helm-lint:
  script:
    - helm lint charts/${HELM_NAME}

.helm-yamllint:
  script:
    - yamllint charts/${HELM_NAME} -d "$(cat < tools/gci-templates/yamllint.yaml) $(cat < tools/gci-templates/yamllint-helm-exclude-chart-templates.yaml)"

.helm-template-yamllint:
  script:
    - helm dependency build charts/${HELM_NAME}
    - helm template ${HELM_NAME} charts/${HELM_NAME} | yamllint - -d "$(cat < tools/gci-templates/yamllint.yaml) $(cat < tools/gci-templates/yamllint-helm-template-rules)"
